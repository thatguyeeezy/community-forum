(()=>{var e={};e.id=260,e.ids=[260],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},40436:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>f,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>c});var o=t(42706),i=t(28203),d=t(45994),a=t(45369),n=t(51825);let c=t.n(n)()(a.N),u=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/auth/discord/callback/route",pathname:"/auth/discord/callback",filename:"route",bundlePath:"app/auth/discord/callback/route"},resolvedPagePath:"C:\\xampp\\nodejs-apps\\community-forum\\app\\auth\\discord\\callback\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:f}=u;function m(){return(0,d.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}},96487:()=>{},78335:()=>{},45369:(e,r,t)=>{"use strict";t.d(r,{N:()=>c,j:()=>u});var s=t(46814),o=t(34926),i=t(51825),d=t(91642),a=t(64912),n=t(11587);let c={adapter:(0,s.y)(n.z),pages:{signIn:"/auth/signin",signOut:"/auth/signout",error:"/auth/error"},session:{strategy:"jwt"},providers:[(0,a.A)({clientId:process.env.DISCORD_CLIENT_ID||"",clientSecret:process.env.DISCORD_CLIENT_SECRET||"",authorization:{params:{scope:"identify email"}},callbackUrl:"http://198.154.99.127:3000/auth/discord/callback",profile:e=>(console.log("Discord profile received:",e),{id:e.id,name:e.username,email:e.email,image:e.avatar?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:null})}),(0,d.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await n.z.user.findUnique({where:{email:e.email}});return r&&r.password&&await (0,o.UD)(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image,role:r.role}:null}})],callbacks:{async signIn({user:e,account:r,profile:t}){if(r?.provider==="discord"&&t)try{console.log("Discord sign-in for user ID:",e.id),await n.z.user.update({where:{id:Number.parseInt(e.id,10)},data:{discordId:t.id,department:"N_A"}}),console.log("Updated user with Discord ID from profile:",t.id),setTimeout(async()=>{try{let r=await n.z.account.findFirst({where:{provider:"discord",userId:Number.parseInt(e.id,10)}});r&&(console.log("Found Discord account in accounts table:",r.providerAccountId),await n.z.user.update({where:{id:Number.parseInt(e.id,10)},data:{discordId:r.providerAccountId}}),console.log("Updated user with Discord ID from accounts table"))}catch(e){console.error("Error in delayed Discord ID update:",e)}},2e3)}catch(e){console.error("Error updating Discord ID during sign-in:",e)}return!0},async session({session:e,token:r}){if(e.user&&r.sub){e.user.id=r.sub,e.user.role=r.role,r.discordId&&(e.user.discordId=r.discordId);try{let t=Number.parseInt(r.sub,10),s=await n.z.user.findUnique({where:{id:t},select:{discordId:!0,department:!0,role:!0}});if(s&&(s.discordId&&(e.user.discordId=s.discordId),e.user.department=s.department,e.user.role=s.role,console.log("Session updated with user data:",{discordId:s.discordId,department:s.department,role:s.role}),!s.discordId)){let r=await n.z.account.findFirst({where:{provider:"discord",userId:t}});r&&(console.log("Found Discord account but user doesn't have Discord ID. Updating..."),await n.z.user.update({where:{id:t},data:{discordId:r.providerAccountId}}),e.user.discordId=r.providerAccountId,console.log("Updated user and session with Discord ID from accounts table"))}}catch(e){console.error("Error fetching user data for session:",e)}}return e},jwt:async({token:e,user:r,account:t,profile:s})=>(t&&r&&("discord"===t.provider&&s&&(e.discordId=s.id,console.log("Added Discord ID to JWT token:",s.id)),e.role=r.role),e)},events:{async createUser(e){let{user:r}=e;if(console.log("New user created:",r.id,r.email),r.email)try{setTimeout(async()=>{try{let e=await n.z.account.findFirst({where:{userId:r.id,provider:"discord"}});e&&(console.log("Found Discord account for new user:",e.providerAccountId),await n.z.user.update({where:{id:r.id},data:{discordId:e.providerAccountId,department:"N_A",role:"APPLICANT"}}),console.log("Updated new user with Discord ID and set as APPLICANT"))}catch(e){console.error("Error in delayed createUser processing:",e)}},2e3)}catch(e){console.error("Error in createUser event:",e)}},async linkAccount({user:e,account:r,profile:t}){if("discord"===r.provider&&t){console.log("Account linked:",e.id,r.provider,r.providerAccountId);try{await n.z.user.update({where:{id:e.id},data:{discordId:r.providerAccountId}}),console.log("Updated user with Discord ID from linkAccount event")}catch(e){console.error("Error updating Discord ID in linkAccount event:",e)}}}}};async function u(){return await (0,i.getServerSession)(c)}},11587:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(96330);let o=globalThis.prisma??new s.PrismaClient},37301:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return n}});let s=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o(void 0);if(t&&t.has(e))return t.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in e)if("default"!==d&&Object.prototype.hasOwnProperty.call(e,d)){var a=i?Object.getOwnPropertyDescriptor(e,d):null;a&&(a.get||a.set)?Object.defineProperty(s,d,a):s[d]=e[d]}return s.default=e,t&&t.set(e,s),s}(t(76301));function o(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(o=function(e){return e?t:r})(e)}let i={current:null},d="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function n(e){return function(...r){a(e(...r))}}d(e=>{try{a(i.current)}finally{i.current=null}})},42706:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,512,103],()=>t(40436));module.exports=s})();