(()=>{var e={};e.id=28,e.ids=[28],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},33873:e=>{"use strict";e.exports=require("path")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},95684:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>l,routeModule:()=>m,tree:()=>c});var i=s(70260),t=s(28203),n=s(25155),a=s.n(n),d=s(67292),o={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);s.d(r,o);let c=["",{children:["community",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,61107)),"C:\\xampp\\nodejs-apps\\community-forum\\app\\community\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,28933)),"C:\\xampp\\nodejs-apps\\community-forum\\app\\community\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,78237)),"C:\\xampp\\nodejs-apps\\community-forum\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"]}],l=["C:\\xampp\\nodejs-apps\\community-forum\\app\\community\\page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:t.RouteKind.APP_PAGE,page:"/community/page",pathname:"/community",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},65316:(e,r,s)=>{Promise.resolve().then(s.bind(s,36805)),Promise.resolve().then(s.t.bind(s,59607,23))},18468:(e,r,s)=>{Promise.resolve().then(s.bind(s,29637)),Promise.resolve().then(s.t.bind(s,28531,23))},96487:()=>{},78335:()=>{},28933:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>n,metadata:()=>t});var i=s(62740);let t={title:"Community - Florida Coast RP",description:"Browse discussions, resources, and departments in our community"};function n({children:e}){return(0,i.jsx)("div",{className:"flex min-h-screen flex-col",children:e})}},61107:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>N});var i=s(62740),t=s(38537),n=s(19935),a=s(36805),d=s(83238);let o=(0,d.A)("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]),c=(0,d.A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var l=s(82520),u=s(48413),m=s(90287),p=s(81660);let h=(0,d.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var x=s(58057),v=s(19626),y=s(59607),f=s.n(y),g=s(11587),j=s(51825),w=s(45369);function b(e,r,s){return"announcements"===e?"SENIOR_ADMIN"===r||"HEAD_ADMIN"===r:"recruitment"===e?"RNR_ADMINISTRATION"===s||"RNR_STAFF"===s:!!r}async function N(){let e=await (0,j.getServerSession)(w.N),r=await g.z.category.findMany({where:{parentId:null},include:{_count:{select:{threads:!0}},children:{include:{_count:{select:{threads:!0}}}},threads:{take:0}},orderBy:{order:"asc"}}),s=r.map(e=>e.id);await g.z.post.groupBy({by:["threadId"],_count:{_all:!0},where:{thread:{categoryId:{in:s}}}});let d={};for(let e of r){let r=(await g.z.thread.findMany({where:{categoryId:e.id},select:{id:!0}})).map(e=>e.id),s=await g.z.post.count({where:{threadId:{in:r}}});d[e.id]=s}let y=[];try{let e=await g.z.departmentInfo.findMany({include:{_count:{select:{users:!0}},subdivisions:!0},orderBy:{name:"asc"}});y=e.length>0?e.map(e=>({id:e.id,name:e.name,description:e.description||"",memberCount:e._count.users,icon:p.A,subdivisions:e.subdivisions.map(e=>e.name)})):I()}catch(e){console.error("Error fetching departments:",e),y=I()}return(0,i.jsxs)("div",{className:"container mx-auto py-6 px-4 md:px-6",children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Community"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Browse discussions, resources, and departments"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)(t.$,{variant:"outline",size:"sm",children:[(0,i.jsx)(h,{className:"h-4 w-4 mr-2"}),"Filter"]}),e?(0,i.jsx)(t.$,{size:"sm",asChild:!0,children:(0,i.jsxs)(f(),{href:"/community/new-thread",children:[(0,i.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"New Thread"]})}):(0,i.jsx)(t.$,{size:"sm",asChild:!0,children:(0,i.jsxs)(f(),{href:"/auth/signin?callbackUrl=/community",children:[(0,i.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"New Thread"]})})]})]}),(0,i.jsxs)(a.Tabs,{defaultValue:"community",className:"space-y-4",children:[(0,i.jsxs)(a.TabsList,{children:[(0,i.jsx)(a.TabsTrigger,{value:"community",children:"Community"}),(0,i.jsx)(a.TabsTrigger,{value:"departments",children:"Departments"})]}),(0,i.jsx)(a.TabsContent,{value:"community",className:"space-y-4",children:r.map(r=>{let s=function(e){let r=e.toLowerCase();return r.includes("announcement")?o:r.includes("recruitment")||r.includes("retention")?c:r.includes("general")||r.includes("discussion")?l.A:r.includes("introduction")||r.includes("member")?u.A:r.includes("tutorial")||r.includes("resource")?m.A:r.includes("admin")?p.A:l.A}(r.name),t=r._count.threads,a=d[r.id]||0,h=b(r.id,e?.user?.role,e?.user?.department);return(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"flex flex-row items-center gap-4 pb-2",children:[(0,i.jsx)("div",{className:"rounded-full bg-primary/10 p-2",children:(0,i.jsx)(s,{className:"h-5 w-5 text-primary"})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(n.ZB,{children:(0,i.jsx)(f(),{href:`/community/${r.id}`,className:"hover:underline",children:r.name})}),!h&&(0,i.jsxs)("div",{className:"flex items-center text-muted-foreground text-sm",children:[(0,i.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Restricted"]})]}),(0,i.jsx)(n.BT,{children:r.description})]})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(l.A,{className:"mr-1 h-4 w-4"}),t," threads"]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(m.A,{className:"mr-1 h-4 w-4"}),a," posts"]})]}),r.children.length>0&&(0,i.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,i.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Subcategories"}),(0,i.jsx)("div",{className:"grid gap-2",children:r.children.map(s=>{let t=b(s.id,e?.user?.role,e?.user?.department);return(0,i.jsxs)(f(),{href:`/community/${r.id}/${s.id}`,className:"flex items-center justify-between rounded-md p-2 hover:bg-muted",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("h5",{className:"font-medium",children:s.name}),!t&&(0,i.jsxs)("div",{className:"ml-2 flex items-center text-muted-foreground text-xs",children:[(0,i.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Restricted"]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:s.description})]}),(0,i.jsxs)("div",{className:"text-xs text-muted-foreground",children:[s._count.threads," threads"]})]},s.id)})})]})]})]})},r.id)})}),(0,i.jsx)(a.TabsContent,{value:"departments",children:(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(e=>(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"rounded-full bg-primary/10 p-2",children:(0,i.jsx)(e.icon,{className:"h-5 w-5 text-primary"})}),(0,i.jsx)(n.ZB,{className:"text-xl",children:e.name})]}),(0,i.jsx)(n.BT,{children:e.description})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("span",{className:"text-sm font-medium",children:"Members: "}),(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:e.memberCount})]}),e.subdivisions.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h4",{className:"text-sm font-medium",children:"Subdivisions"}),(0,i.jsx)("div",{className:"grid gap-1",children:e.subdivisions.map((r,s)=>(0,i.jsxs)(f(),{href:`/community/departments/${e.id}/${r.toLowerCase().replace(/\s+/g,"-")}`,className:"text-sm rounded-md p-2 hover:bg-muted flex justify-between items-center",children:[(0,i.jsx)("span",{children:r}),(0,i.jsx)(t.$,{variant:"ghost",size:"sm",children:"View"})]},s))})]}),(0,i.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,i.jsx)(t.$,{asChild:!0,variant:"outline",className:"w-full",children:(0,i.jsx)(f(),{href:`/community/departments/${e.id}`,children:"View Department"})})})]})]},e.id))})})]})]})}function I(){return[{id:"civ",name:"CIV – Civilian",description:"Civilian operations and roleplay",memberCount:245,icon:u.A,subdivisions:["Businesses","Criminal Organizations","Civilian Jobs"]},{id:"fhp",name:"FHP – Florida Highway Patrol",description:"State law enforcement agency",memberCount:78,icon:p.A,subdivisions:["Patrol Division","Special Operations","Training Division"]},{id:"mpd",name:"MPD – Miami Police Department",description:"City police department",memberCount:92,icon:p.A,subdivisions:["Patrol","Investigations","Special Units"]},{id:"bso",name:"BSO – Broward Sheriff's Office",description:"County law enforcement agency",memberCount:65,icon:p.A,subdivisions:["Patrol","Corrections","Special Units"]}]}},45369:(e,r,s)=>{"use strict";s.d(r,{N:()=>c,j:()=>l});var i=s(46814),t=s(34926),n=s(51825),a=s(91642),d=s(64912),o=s(11587);let c={adapter:(0,i.y)(o.z),pages:{signIn:"/auth/signin",signOut:"/auth/signout",error:"/auth/error"},session:{strategy:"jwt"},providers:[(0,d.A)({clientId:process.env.DISCORD_CLIENT_ID||"",clientSecret:process.env.DISCORD_CLIENT_SECRET||"",authorization:{params:{scope:"identify email"}},callbackUrl:"http://198.154.99.127:3000/auth/discord/callback",profile:e=>(console.log("Discord profile received:",e),{id:e.id,name:e.username,email:e.email,image:e.avatar?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:null})}),(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await o.z.user.findUnique({where:{email:e.email}});return r&&r.password&&await (0,t.UD)(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image,role:r.role}:null}})],callbacks:{async signIn({user:e,account:r,profile:s}){if(r?.provider==="discord"&&s)try{console.log("Discord sign-in for user ID:",e.id),await o.z.user.update({where:{id:Number.parseInt(e.id,10)},data:{discordId:s.id,department:"N_A"}}),console.log("Updated user with Discord ID from profile:",s.id),setTimeout(async()=>{try{let r=await o.z.account.findFirst({where:{provider:"discord",userId:Number.parseInt(e.id,10)}});r&&(console.log("Found Discord account in accounts table:",r.providerAccountId),await o.z.user.update({where:{id:Number.parseInt(e.id,10)},data:{discordId:r.providerAccountId}}),console.log("Updated user with Discord ID from accounts table"))}catch(e){console.error("Error in delayed Discord ID update:",e)}},2e3)}catch(e){console.error("Error updating Discord ID during sign-in:",e)}return!0},async session({session:e,token:r}){if(e.user&&r.sub){e.user.id=r.sub,e.user.role=r.role,r.discordId&&(e.user.discordId=r.discordId);try{let s=Number.parseInt(r.sub,10),i=await o.z.user.findUnique({where:{id:s},select:{discordId:!0,department:!0,role:!0}});if(i&&(i.discordId&&(e.user.discordId=i.discordId),e.user.department=i.department,e.user.role=i.role,console.log("Session updated with user data:",{discordId:i.discordId,department:i.department,role:i.role}),!i.discordId)){let r=await o.z.account.findFirst({where:{provider:"discord",userId:s}});r&&(console.log("Found Discord account but user doesn't have Discord ID. Updating..."),await o.z.user.update({where:{id:s},data:{discordId:r.providerAccountId}}),e.user.discordId=r.providerAccountId,console.log("Updated user and session with Discord ID from accounts table"))}}catch(e){console.error("Error fetching user data for session:",e)}}return e},jwt:async({token:e,user:r,account:s,profile:i})=>(s&&r&&("discord"===s.provider&&i&&(e.discordId=i.id,console.log("Added Discord ID to JWT token:",i.id)),e.role=r.role),e)},events:{async createUser(e){let{user:r}=e;if(console.log("New user created:",r.id,r.email),r.email)try{setTimeout(async()=>{try{let e=await o.z.account.findFirst({where:{userId:r.id,provider:"discord"}});e&&(console.log("Found Discord account for new user:",e.providerAccountId),await o.z.user.update({where:{id:r.id},data:{discordId:e.providerAccountId,department:"N_A",role:"APPLICANT"}}),console.log("Updated new user with Discord ID and set as APPLICANT"))}catch(e){console.error("Error in delayed createUser processing:",e)}},2e3)}catch(e){console.error("Error in createUser event:",e)}},async linkAccount({user:e,account:r,profile:s}){if("discord"===r.provider&&s){console.log("Account linked:",e.id,r.provider,r.providerAccountId);try{await o.z.user.update({where:{id:e.id},data:{discordId:r.providerAccountId}}),console.log("Updated user with Discord ID from linkAccount event")}catch(e){console.error("Error updating Discord ID in linkAccount event:",e)}}}}};async function l(){return await (0,n.getServerSession)(c)}},11587:(e,r,s)=>{"use strict";s.d(r,{z:()=>t});var i=s(96330);let t=globalThis.prisma??new i.PrismaClient},19626:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});let i=(0,s(83238).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},58057:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});let i=(0,s(83238).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},81660:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});let i=(0,s(83238).A)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),i=r.X(0,[638,423,512,103,85,45,397],()=>s(95684));module.exports=i})();